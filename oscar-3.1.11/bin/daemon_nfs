#!/bin/sh


## Copyright (c) 2003-2013 Tissoires Jean-FranÃ§ois & Benjamin,  jftissoires@gmail.com
## Outil SystÃ¨me Complet d'Assistance RÃ©seau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et SystÃ¨mes: RapideSOS
## Ce programme est sous Licence Publique GÃ©nÃ©rale GNU publiÃ©e par la Free Software Foundation.



###################### SI PLUSIEURS CLIENTS NFS SIMULTANES SANS REACTIVE RESTART ###############
####
#### plusieurs clients en nfs si seulement le premier est reconnu.
#### si nfs normal supprimer les commandes /etc/init.d/nfs restart 1>/dev/null 2>/dev/null

# dans lancer_avahi OK laisser le controle


# dans daemon_oscar supprimer la ligne reperee :
###### debug sysrcd 1.6.3 essayer la ligne ci-dessous vérifier lors du deploiement si coupure reseau
#/etc/init.d/nfs restart 2>/dev/null 1>/dev/null

###### debug sysrcd 1.6.3 essayer dans serveur nfs les 2 lignes ci-dessous verifier lors du deploiement si coupure reseau
# echo "" > /etc/serveur_asynchrone_lance
# daemon_nfs start	# en tache de fond ESSAI

# supprimer dans les fichiers :
# daemon_nfs start	# dans daemon_oscar
# daemon_nfs stop	# dans daemon_oscar serveur_clone serveur_multi serveur_table serveur_disque
# daemon_nfs start	# en tache de fond ESSAI # dans serveur nfs
####
###################### fin SI PLUSIEURS CLIENTS NFS SIMULTANES SANS REACTIVE RESTART ###############


PATH="/usr/share/oscar/bin:$PATH"
if ( test -e /usr/share/oscar/usr/choix_langue )
then
	choix_langue=`cat /usr/share/oscar/usr/choix_langue`
else
	echo "fr" > /usr/share/oscar/usr/choix_langue
	choix_langue=fr
	traduction
fi
chemin_langue=/usr/share/oscar/usr/langue/$choix_langue


#-------------------------------------------------------------------------------------------------------------------------
start()
{
if ( test -e /etc/daemon_nfs_lance  )
then
	/etc/init.d/nfs restart 1>/dev/null 2>/dev/null
	sleep $temps_pour_daemon_nfs
	start
fi
}
#-------------------------------------------------------------------------------------------------------------------------


# dans /etc/conf.d/oscar.conf adresse du serveur modele multicast et demarrage du serveur daemon encore en action
# partager en nfs le fichier procedure_oscar_nfs qui contient : 192.168.168.69,synchrone (remplacer 192 par 233) ou 192.168.168.69,asynchrone


#  commandes externes de procÃ©dures
case "$1" in
    start)
	echo "" > /etc/daemon_nfs_lance
	# nohup
	temps_pour_daemon_nfs=3	# temps pour serveur synchrone
	if ( test -e /etc/serveur_asynchrone_lance )
	then
		rm -f /etc/serveur_asynchrone_lance
		# temps_pour_daemon_nfs=10
		temps_pour_daemon_nfs=60
	fi
	start &
	exit 0
	;;
    stop)
    	rm -f /etc/daemon_nfs_lance
    	rm -f /etc/serveur_asynchrone_lance
    	exit 0
    	;;
esac