#!/bin/bash

## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin,  jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.


#
#-----------------------------------------------------------------------------------------------------
main() # boucle principale
{
	DIALOGRC="/etc/dialogmenu_bloque" dialog --colors \
	--backtitle "`cat /etc/banniere_oscar`" \
	--ok-label "Continuer" --no-cancel \
	--title " Erreur de commande du client en mode MULTICAST " \
	--menu "\n\Zb\Z1   Arrêt de la procédure `cat /tmp/tempfile`\n" 10 69 0 \
	"" "" \
	"" "\Z2Vous avez choisi la commande \Zb\Z3$commande_client\Zn\Z2, sur ce poste," \
	"" "\Z2sur le SERVEUR vous avez lancé la commande \Zb\Z3$commande_serveur\Zn\Z2. " \
	"" "" \
	"" "\Zb\Z1Vous devez maintenant arrêter tous les postes clients et " \
	"" "\Zb\Z1le serveur avec les touches \Zb\Z7Ctrl_c\Zn. " \
	"" "" \
	"" "\Z2Puis lancez \Zb\Z1OSCAR \Zn\Z2avec la commande \Zb\Z3oscar\Zn\Z2. " \
	"" ""
      case $? in
	    0)	rm -f /tmp/tempfile
	    exit;;
	    255) rm -f /tmp/tempfile
	    exit;;
	esac
}
#-----------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------
#                   BOUCLE PRINCIPALE
#-----------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------
commande_serveur=`cat ctrl_serveur`
rm -f ctrl_serveur
rm -f /tmp/tempfile
	if [ "$commande_serveur" = "serveur_clone" ]
	then
		echo "d'installation" > /tmp/tempfile
	elif [ "$commande_serveur" = "serveur_multi" ]
	then
		echo "de restauration" > /tmp/tempfile
	elif [ "$commande_serveur" = "serveur_disq" ]
	then
		commande_serveur="serveur_disque"
		echo "de clonage d'un disque" > /tmp/tempfile
	elif [ "$commande_serveur" = "serveur_table" ]
	then
		echo "de copie des partitions" > /tmp/tempfile
	fi

commande_client=`cat ctrl_client`
rm -f ctrl_client
main