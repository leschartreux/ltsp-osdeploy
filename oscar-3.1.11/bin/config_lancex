#! /bin/bash

## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin,  jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.



PATH="/usr/share/oscar/bin:$PATH"
if ( test -e /usr/share/oscar/usr/choix_langue )
then
	choix_langue=`cat /usr/share/oscar/usr/choix_langue`
else
	echo "fr" > /usr/share/oscar/usr/choix_langue
	choix_langue=fr
	traduction
fi
chemin_langue=/usr/share/oscar/usr/langue/$choix_langue

if ! ( test -e /etc/startx_lance )
then
	if [ "$(uname -m)" = "x86_64" ]
	then
		rm -f /tmp/definition_vesa
		echo "forcexorg" > /root/xserver.cfg
		startx_oscar
		rm -f /tmp/test_x
	else
		echo
		echo -e "\033[1;33m OSCAR \033[1;34m`cat $chemin_langue/texte_70`, "
		echo -e " \033[1;34m`cat $chemin_langue/texte_71`\033[1;34m ... "
		rm -f /tmp/test_x
		startx_oscar
	        grep -ci "PAS Fatal server error" /tmp/test_x > /tmp/tempnombre
	        test_x=`cat /tmp/tempnombre`
	        rm -f /tmp/tempnombre
	        rm -f /tmp/test_x
	        if [ "$test_x" = "1" ]       # carte graphique non reconnue
	        then
	        	cp -f /tmp/definition_vesa /root/xserver.cfg
	        	rm -f /tmp/definition_vesa
	        	echo
			echo -e "\033[1;33m OSCAR\033[1;34m `cat $chemin_langue/texte_72`,"
			echo -e " \033[1;34m`cat $chemin_langue/texte_71`\033[1;34m ..."
			startx_oscar
			grep -ci "PAS Fatal server error" /tmp/test_x > /tmp/tempnombre
		        test_x=`cat /tmp/tempnombre`
		        rm -f /tmp/test_x
		        rm -f /tmp/tempnombre
		        if [ "$test_x" = "1" ]       # carte graphique non reconnue
		        then
				wizard_oscar xvesa-cfg
		        fi
	        fi
	fi
elif ( test -e /tmp/tmp_xfburn )
then
	rm -f /tmp/tmp_xfburn
	/usr/bin/xfburn 2>/dev/null
elif ( test -e /tmp/tmp_firefox )
then
	rm -f /tmp/tmp_firefox
	/usr/bin/firefox-bin 2>/dev/null
elif ( test -e /tmp/tmp_midori )
then
	rm -f /tmp/tmp_midori
	/usr/bin/midori 2>/dev/null	
elif ( test -e /tmp/gp )
then
	rm -f /tmp/gp
	/usr/sbin/gparted 2>/dev/null
elif ( test -e /tmp/links )
then
	rm -f /tmp/links 2>/dev/null
	links
elif ( test -e /tmp/tmp_vnc )
then
	rm -f /tmp/tmp_vnc 2>/dev/null
	vncviewer
elif ( test -e /tmp/tmp_oscarx )
then
	rm -f /tmp/tmp_oscarx
	oscar
fi
rm -f /tmp/definition_vesa
exit 0
