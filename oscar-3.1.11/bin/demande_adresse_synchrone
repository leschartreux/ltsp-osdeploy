#!/bin/bash

## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin,  jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.


PATH="/usr/share/oscar/bin:$PATH"

# ce programme n'est plus utilise


#
#-----------------------------------------------------------------------------------------------------
modifier_adresse_synchrone()
{
	rm -f /tmp/tempfile
	DIALOGRC="/etc/dialogmenu_bloque" dialog --colors \
	--backtitle "`cat /etc/banniere_oscar`" \
	--cancel-label "Annuler"  --title " Choix de la valeur d'IP du mode synchrone " \
	--inputbox "\n\n Les adresses\Z2 IP synchrone\Zn possibles sont: \
	\n\n   de \Z2224.0.1.0 \Znà\Z2 239.255.255.255 \
	\n\n   \Znvous ne pouvez modifier que le premier terme
	\n   votre valeur actuelle est \Zb\Z3$adresse_synchrone_un\Zn.
	\n\n\n\Zb\Z4Donnez la valeur du\Z3 premier\Z4 terme (\Zn\Z2232\Zb\Z4 par défaut) de l'adresse synchrone :  " 0 0 232 2>/tmp/tempfile
	case $? in
	    0)  reponse=`cat /tmp/tempfile`
	    	rm -f adresse_synchrone
	    	echo "$reponse"  > adresse_synchrone
		adresse_synchrone_un=`cat adresse_synchrone`

		DIALOGRC="/etc/dialogmenu_bloque" dialog --colors \
		--backtitle "`cat /etc/banniere_oscar`" \
		--ok-label "Accepter" --cancel-label "Annuler" --title " Choix de l'adresse synchrone de contrôle " \
		--extra-button --extra-label "Modifier" \
		--menu "\n\Zb\Z4  Adresse de contrôle utilisée par \Z1OSCAR    \n\n" 12 60 0 \
		"" "" \
		"" "" \
		"" "Vous avez choisi : \Z2$adresse_synchrone_un.\Zn`cat /tmp/tempfile1`" \
		"" "" \
		"" "" \
		"" ""
		case $? in
		    0)	exit;;
		    3)	modifier_adresse_synchrone;;	# Modifier
		    255) rm -f adresse_synchrone
			echo "232" > adresse_synchrone
			rm -f /tmp/tmpfile
			rm -f /tmp/tmpfile1
		    	exit;;
		esac ;;
	    1)	rm -f adresse_synchrone
		echo "232" > adresse_synchrone
		rm -f /tmp/tmpfile
		rm -f /tmp/tmpfile1
		exit;;
	    255) rm -f adresse_synchrone
		echo "232" > adresse_synchrone
		rm -f /tmp/tmpfile
		rm -f /tmp/tmpfile1
		exit;;
	esac		
}
#-----------------------------------------------------------------------------------------------------
main() # boucle principale
{

	ip_installe=`cat ip_installe_poste` # ip du poste
	rm -f /tmp/tempfile
	echo `cut -d"." -f1-3 ip_installe_poste` > /tmp/tempfile
	adresse_synchrone_deux=`cat /tmp/tempfile`.255
	rm -f /tmp/tempfile

	rm -f /tmp/tempfile
	echo `cut -d"." -f1 adresse_synchrone` > /tmp/tempfile	## si ancienne version
	adresse_synchrone_un=`cat /tmp/tempfile`
	rm -f /tmp/tempfile

	rm -f /tmp/tempfile1
	echo `cut -d"." -f2-4 ip_installe_poste` > /tmp/tempfile1
	adresse_synchrone_ctrl=$adresse_synchrone_un"."`cat /tmp/tempfile1`


	DIALOGRC="/etc/dialogmenu_bloque" dialog --colors \
	--backtitle "`cat /etc/banniere_oscar`" \
	--cancel-label "Annuler" --ok-label "Accepter l'adresse" --extra-button --extra-label "Modifier l'adresse" \
	--title " Adressage d'OSCAR en mode synchrone " \
	--menu "\n\Zb\Z4   Information sur les adresses de contrôle utilisées par \Z1OSCAR\n\n" 0 0 0 \
	"" "" \
	"" "\Z2En mode synchrone \Zb\Z1OSCAR\Zn\Z2 utilise pour le contrôle deux adresses IP :" \
	"" "" \
	"" "\Z2une adresse synchrone    :\Zb\Z4 $adresse_synchrone_ctrl \Zn " \
	"" "" \
	"" "\Z2et une adresse BROADCAST :\Zb\Z4 $adresse_synchrone_deux \Zn " \
	"" "" \
	"" "\ZnSi vous avez un hub ou un switch programmable sur votre réseau: " \
	"" "vous devez \Zb\Z4autoriser \Znces deux adresses.  " \
	"" "" \
	"" "Exceptionnellement vous pouvez modifier l'adresse de contrôle \Zb\Z4$adresse_synchrone_ctrl \Zn:" \
	"" ""
      case $? in
	    0)	exit;;
	  
	    1)	rm -f adresse_synchrone
		echo "232" > adresse_synchrone
		rm -f /tmp/tmpfile
		rm -f /tmp/tmpfile1
		exit;;
		
	    3) 	modifier_adresse_synchrone
	    	;;
		
	    255) rm -f adresse_synchrone
		echo "232" > adresse_synchrone
		rm -f /tmp/tmpfile
		rm -f /tmp/tmpfile1
		exit;;
	esac
}
#-----------------------------------------------------------------------------------------------------

#----------------------------------------------------------------------------------------------------
#                   BOUCLE PRINCIPALE
#----------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------
main