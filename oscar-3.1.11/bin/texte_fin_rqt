#!/bin/sh

## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin, jftissoires@gmail.com
## Cdrom Outil Système Complet d'Assistance Réseau: OSCAR
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.


PATH="/usr/share/oscar/bin:$PATH"
if ( test -e /usr/share/oscar/usr/choix_langue )
then
	choix_langue=`cat /usr/share/oscar/usr/choix_langue`
else
	echo "fr" > /usr/share/oscar/usr/choix_langue
	choix_langue=fr
	traduction
fi
chemin_langue=/usr/share/oscar/usr/langue/$choix_langue


#----------------------------------------------------------------------------------------------------
boite_apres_gparted()
{
	# Informations sur le(s) disque(s) dur(s)
	runme prepare_fichier_temptaille
	runme colorier_selection_info
	cp -f /tmp/couleurs_info /tmp/fichier_disque_dur
	rm -f /tmp/couleurs_info
	perl -pi -e 's/ 1  1  /      /g;' /tmp/fichier_disque_dur
	
	# runme boite_couleurs_fichier_disque_dur
	DIALOGRC="/etc/dialogmenu_bloque" dialog --colors \
	--backtitle "`cat /etc/banniere_oscar`" \
	--cancel-label "`cat $chemin_langue/Modifier`" --ok-label "`cat $chemin_langue/Accepter`" \
	--title " `cat $chemin_langue/menu_429` " \
        --menu "`cat /tmp/fichier_disque_dur`" 0 0 0 \
        "" "`cat $chemin_langue/menu_430` \Z2Linux\Zn :" \
	"" "`cat $chemin_langue/menu_431`. "
        case $? in
	    0)	rm -f /tmp/fichier_disque_dur
	    	 ;;
	    1)  rm -f /tmp/fichier_disque_dur
	    	runme boite_cfdisk
	    	;;
	    255) rm -f /tmp/fichier_disque_dur
	    	;;
	esac

}
#----------------------------------------------------------------------------------------------------
boite_fin()
{
		if ( test -e /tmp/fin_qt )
		then
			logiciel=QTParted
		elif ( test -e /tmp/fin_rqt_fb_oscar )
		then
			logiciel=taille_partition
		else
			logiciel=GParted
		fi

	# Informations sur le(s) disque(s) dur(s)
	runme prepare_fichier_temptaille
	runme prepare_fichier_temptaille
	runme colorier_selection_info
	cp -f /tmp/couleurs_info /tmp/fichier_disque_dur
	rm -f /tmp/couleurs_info
	perl -pi -e 's/ 1  1  /      /g;' /tmp/fichier_disque_dur
	
	# runme boite_couleurs_fichier_disque_dur
	DIALOGRC="/etc/dialogmenu_bloque" dialog --colors \
	--backtitle "`cat /etc/banniere_oscar`" \
	--cancel-label "$logiciel" --ok-label "`cat $chemin_langue/Continuer`" \
	--title " `cat $chemin_langue/menu_429` " \
        --menu "`cat /tmp/fichier_disque_dur`" 0 0 0 \
	"" "\Zn\Z2`cat $chemin_langue/menu_432` \Zb\Z7* "
        case $? in
	    0)	rm -f /tmp/fichier_disque_dur
	    	exit ;;
	    1)  rm -f /tmp/fichier_disque_dur
		if ( test -e /tmp/fin_qt )
		then
			# startx
			run_qtparted
		elif ( test -e /tmp/fin_rqt_fb_oscar )
		then
			echo "" /tmp/retour
			run_qtpartedfb_oscar
			rm -f /tmp/retour
		else
			# startx
			run_gparted
		fi
		boite_fin ;;
	    255) rm -f /tmp/fichier_disque_dur
	    	exit ;;
	esac
}
#----------------------------------------------------------------------------------------------------
if ! ( test -e /tmp/fin_qt ) || ! ( test -e /tmp/fin_rqt_fb_oscar )
then
	boite_apres_gparted
fi
boite_fin
