#!/bin/bash


## DANGER éditer ce texte avec Linux et MC pour le rendre propre !


## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin, jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.


PATH="/usr/share/oscar/bin:$PATH"
if ( test -e /usr/share/oscar/usr/choix_langue )
then
	choix_langue=`cat /usr/share/oscar/usr/choix_langue`
else
	echo "fr" > /usr/share/oscar/usr/choix_langue
	choix_langue=fr
	traduction
fi
chemin_langue=/usr/share/oscar/usr/langue/$choix_langue

# affectation du nom du poste par OSCAR

Poste_OSCAR=`cat /tmp/nom_oscar_poste`
# Partition_OSCAR=`cat /tmp/partition_oscar_lettre_win`
Partition_OSCAR=C

# Windows XP et 2000
# version=`cat /tmp/version_windows` 		# inutile pour l'instant 
#  a utiliser pour NT
	version=windows98
# if [ "$version" = "windowsxp" ]
#	then
#	version_regedit="Windows Registry Editor Version 5.00"
#	echo "$version_regedit"
#	redemarre="SHUTDOWN -r -t 1"
# elif [ "$version" = "windows98" ]
#	then
#	version_regedit="REGEDIT4"
#	redemarre="RUNDLL32 SHELL32.DLL,SHExitWindowsEx 4"
# fi

rm -f /tmp/cherche_oscar.bat
rm -f /tmp/cherche_oscar_modifstartup_nom.reg
rm -f /tmp/fin_cherche_oscar_modifstartup_nom.reg
echo "WScript.Sleep(1000)" > /tmp/delay.vbs
#if [ "$Partition_OSCAR" = "C" ]
#then
#	echo "@echo off" > /tmp/cherche_oscar_modifstartup_nom.reg
#	echo "rem
#	rem ## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin, jftissoires@gmail.com
#	rem ## Outil Système Complet d'Assistance Réseau: OSCAR
#	rem ## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
#	rem ## Ce programme est libre, vous pouvez le redistribuer et/ou le modifier selon les termes
#	rem ## de la Licence Publique Générale GNU publiée par la Free Software Foundation.
#	echo.
#	REGEDIT /s C:\oscar_nettoie_numero_poste.reg
#	REGEDIT /s C:\oscar_modifstartup_nom.reg" > /tmp/fin_cherche_oscar_modifstartup_nom.reg
#
#	echo "@echo off
#	rem ## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin, jftissoires@gmail.com
#	rem ## Outil Système Complet d'Assistance Réseau: OSCAR
#	rem ## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
#	rem ## Ce programme est libre, vous pouvez le redistribuer et/ou le modifier selon les termes
#	rem ## de la Licence Publique Générale GNU publiée par la Free Software Foundation.
#	echo.
#	REGEDIT /s C:\fin_numero_poste_oscar.reg
#	C:\demarre_oscar\delay.vbs
#	del C:\oscar_nettoie_numero_poste.reg
#	del C:\oscar_modifstartup_nom.reg
#	del C:\oscar.bat
#	del C:\demarre_oscar\delay.vbs
#	del C:\\\"Documents and Settings\\All Users\\Bureau\\oscar.lnk\"" > /tmp/cherche_oscar.bat
#else
	cherche_fichiers_oscar_sous_windows
	echo "        if not exist %partition_ecrire_oscar%:\oscar_modifstartup_nom.reg goto fin
	REGEDIT /s %partition_ecrire_oscar%:\oscar_nettoie_numero_poste.reg
        REGEDIT /s %partition_ecrire_oscar%:\oscar_modifstartup_nom.reg" > /tmp/fin_cherche_oscar_modifstartup_nom.reg
#fi
# oscar.bat fichier réalisé au premier démarrage

echo "`cat /tmp/cherche_oscar_modifstartup_nom.reg`
`cat /tmp/fin_cherche_oscar_modifstartup_nom.reg`
`cat /tmp/netsh_oscar_bat`
cls
echo.
echo.
echo.
echo.
echo.
echo                    `cat $chemin_langue/texte_81` $Poste_OSCAR
echo.
echo`cat /tmp/ip_oscar_bat`
echo.
echo.
echo                      `cat $chemin_langue/texte_82`.
echo.
echo.
echo.
echo.
echo  *****************************************************************************
echo  *                                                                           *
echo  `cat $chemin_langue/texte_83`
echo  *                                                                           *
echo  *****************************************************************************
echo.
echo.
echo.
del %partition_ecrire_oscar%:\oscar_nettoie_numero_poste.reg
del %partition_ecrire_oscar%:\oscar_modifstartup_nom.reg
pause
cls
call C:\oscar\oscar1.bat

:fin" > oscar.bat



#  fin_numero_poste_oscar.bat  fichier réalisé au deuxième démarrage

echo "`cat /tmp/cherche_oscar.bat`
cls
echo.
echo.
echo.
echo.
echo.
echo.
echo                           `cat $chemin_langue/Poste` : $Poste_OSCAR
echo.
echo.
echo            `cat $chemin_langue/texte_84`,
echo.
echo.
echo.
echo.
echo.
echo.
echo.
pause
cls
call C:\oscar\oscar2.bat

:fin" > fin_numero_poste_oscar.bat

# oscar_modifstartup_nom.reg fichier modifie le nom et le demarrage prochain
echo "REGEDIT4

[HKEY_LOCAL_MACHINE\SOFTWARE\Carip\Session]
\"MaStNDS\"=\"\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Carip\Session]
\"MaStOCX\"=\"\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Novell\WorkstationManager\Identification]
\"Registration Objet\"=\"\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Novell\WorkstationManager\Identification]
\"Workstation Objet\"=\"\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\VxD\VNETSUP]
\"ComputerName\"=\"\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters]
\"NV Hostname\"=\"\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName]
\"ComputerName\"=\"\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName]
\"HostName\"=\"\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Novell\Location Profiles\Services\{1E6CEEA1-FB73-11CF-BD76-00001B27DA23}\Default\Tab3]
\"DefaultDomainName\"=\"\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
\"DefaultDomainName\"=\"\"" > oscar_nettoie_numero_poste.reg


echo "REGEDIT4

[HKEY_LOCAL_MACHINE\SOFTWARE\Carip\Session]
\"MaStNDS\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Carip\Session]
\"MaStOCX\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Novell\WorkstationManager\Identification]
\"Registration Objet\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Novell\WorkstationManager\Identification]
\"Workstation Objet\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\VxD\VNETSUP]
\"ComputerName\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters]
\"NV Hostname\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName]
\"ComputerName\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName]
\"HostName\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Novell\Location Profiles\Services\{1E6CEEA1-FB73-11CF-BD76-00001B27DA23}\Default\Tab3]
\"DefaultDomainName\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
\"DefaultDomainName\"=\"$Poste_OSCAR\"
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]
\"oscarC\"=\"C:\\\\demarre_oscar\\\\fin_numero_poste_oscar.bat\"
`cat oscar_modifstartup_ip.reg`" > oscar_modifstartup_nom.reg

# fin_numero_poste_oscar.reg fichier modifie le nom et le demarrage prochain
echo "REGEDIT4

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run]
\"oscarC\"=\"C:\\\\demarre_oscar\\\\_nettoie__fin_numero_poste_oscar.bat\"" > fin_numero_poste_oscar.reg
