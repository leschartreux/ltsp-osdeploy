#!/bin/sh



## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin,  jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.


# copier un repertoire avec bargraph
#-------------------------------------------------------------------------------
PATH="/usr/share/oscar/bin:$PATH"

#-------------------------------------------------------------------------------
faire_bargraph()
{
perl -pi -e 's/ /,/g; s/,,/,/g;' /tmp/temp_repertoire_bar
cut -d"," -f1 /tmp/temp_repertoire_bar > /tmp/temp_repertoire_bar1
test_fin=`cat /tmp/temp_repertoire_bar1`
if ! [ "$test_fin" = "" ]
then
	# supprimer cette valeur du fichier /tmp/temp_repertoire_bar
	perl -pi -e 's/\//__oscar__/g;' /tmp/temp_repertoire_bar1
	perl -pi -e 's/\//__oscar__/g;' /tmp/temp_repertoire_bar
	echo "perl -pi -e 's/`cat /tmp/temp_repertoire_bar1`,//g;' /tmp/temp_repertoire_bar" > /tmp/exec_nom
	chmod +x /tmp/exec_nom
        /tmp/exec_nom
	rm -f /tmp/exec_nom
	perl -pi -e 's/__oscar__/\//g;' /tmp/temp_repertoire_bar
	perl -pi -e 's/__oscar__/\//g;' /tmp/temp_repertoire_bar1
	
    cd $repertoire_a_copier/`cat /tmp/temp_repertoire_bar1` 2>/dev/null
    test_sous_repertoire=$?
    if [ "$test_sous_repertoire" = 0 ] # c'est un repertoire
    then
	cd /root
	mkdir -p $repertoire_copie/`cat /tmp/temp_repertoire_bar1`

	ls $repertoire_a_copier/`cat /tmp/temp_repertoire_bar1` > /tmp/sous_repertoire1
	test_vide=`cat /tmp/sous_repertoire1`
	if [ "$test_vide" != "" ]
	then

	    # ajouter le contenu du repertoire au fichier /tmp/temp_repertoire_bar
	    echo "," > /tmp/sous_repertoire1
	    ls $repertoire_a_copier/`cat /tmp/temp_repertoire_bar1` >> /tmp/sous_repertoire1
	    echo `gawk '{ print $1 " " }' /tmp/sous_repertoire1 ` > /tmp/sous_repertoire2
	    perl -pi -e 's/ /,/g; s/,,/,/g;' /tmp/sous_repertoire2
	    echo "`cat /tmp/temp_repertoire_bar1`/" > /tmp/sous_repertoire3

	    perl -pi -e 's/\//__oscar__/g;' /tmp/sous_repertoire3
	    echo "perl -pi -e 's/,/,`cat /tmp/sous_repertoire3`/g;' /tmp/sous_repertoire2" > /tmp/exec_nom
	    chmod +x /tmp/exec_nom
    	    /tmp/exec_nom
	    rm -f /tmp/exec_nom
	    perl -pi -e 's/__oscar__/\//g;' /tmp/sous_repertoire2
	
	    echo "`cat /tmp/sous_repertoire2`," >> /tmp/temp_repertoire_bar
	    perl -pi -e 's/
//g;' /tmp/temp_repertoire_bar
	    rm -f /tmp/sous_repertoire1
	    rm -f /tmp/sous_repertoire2
	    rm -f /tmp/sous_repertoire3
	fi
    else	# c'est un fichier
	# copier le fichier
	echo "$repertoire_a_copier/`cat /tmp/temp_repertoire_bar1`" > /tmp/jauge_source
	echo "$repertoire_copie/`cat /tmp/temp_repertoire_bar1`" > /tmp/jauge_destination
	jauge_oscar 
    fi
    faire_bargraph
fi
rm -f /tmp/temp_repertoire_bar
rm -f /tmp/temp_repertoire_bar1
}
#-------------------------------------------------------------------------------
#  commandes externes de proc.dures
case "$1" in
    pas_encore)
        exit 0
        ;;
esac ## fin de commandes externes

repertoire_a_copier=`cat /tmp/repertoire_source`
rm -f /tmp/repertoire_source
repertoire_copie=`cat /tmp/repertoire_destination`
sous_repertoire_copie=$repertoire_copie
rm -f /tmp/repertoire_destination
ls $repertoire_a_copier > /tmp/repertoire_source
echo `gawk '{ print $1 " " }' /tmp/repertoire_source ` > /tmp/temp_repertoire_bar
perl -pi -e 's/ /,/g;' /tmp/temp_repertoire_bar
rm -f /tmp/repertoire_source
rm -f /tmp/sous_repertoire1
faire_bargraph




