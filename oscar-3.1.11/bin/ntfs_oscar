#!/bin/sh



## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin,  jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.


	/tmp/augmenter
	erreur=`cat /tmp/erreur`
	disque=`cat /tmp/disque_ntfs`
	rm -f /tmp/erreur
	rm -f /tmp/augmenter
	rm -f /tmp/disque_ntfs
	
	if [ "$erreur" = "0" ]
	then	# pas d'erreur
		rm -f /tmp/table_partitions.sf

	        # afficher les nouvelles partitions :
	        /usr/share/oscar/bin/runme prepare_fichier_temptaille
		echo "perl -pi -e 's/\/dev\/`cat /tmp/partition`/\\033[1;31m\/dev\/`cat /tmp/partition`\\033[1;m/g;' /tmp/fichier_disque_dur" > /tmp/exec_nom
		chmod +x /tmp/exec_nom
    		/tmp/exec_nom
        	rm -f /tmp/exec_nom
	        cat /tmp/fichier_disque_dur
    	        rm -f /tmp/partition
		echo 
		echo -e "\033[1;34m   Maintenant le poste doit\033[1;31m redémarrer\033[1;34m sous\033[1;31m Windows\033[1;34m !\033[1;m"
		echo
		echo -e "\033[1;34m   Appuyez sur la touche \033[1;37mEntrer \033[1;34mpour redémarrer ...\033[1;m"
		read p
		echo
		echo
		reboot
		sleep 3
	else	# remettre la table des partitions d'origine
		echo
		echo -e "\033[1;31m   ATTENTION\033[1;34m, erreur pendant la redimension :\033[1;m"		
		echo
		# sfdisk -f /dev/$disque < /tmp/table_partitions.sf 2>/dev/null
		echo "$disque" > /tmp/disque_installer_table_sf
		cp -f /tmp/table_partitions.sf /tmp/fichier_installer_table_sf
		runme installer_table_partition_sf
		sleep 2 # obligatoire après l'installation de la table des partitions
		rm -f /tmp/table_partitions.sf
		runme formater_ligne_partitions_vfat_gpt
		echo
		echo -e "\033[1;31m   ATTENTION\033[1;34m, erreur pendant la redimension :\033[1;m"		
		echo
		echo -e "\033[1;33m   OSCAR\033[1;m a remis la \033[1;34mtable des partitions\033[1;m d'origine ..."
		echo
		# afficher les anciennes partitions :
	        /usr/share/oscar/bin/runme prepare_fichier_temptaille
		echo "perl -pi -e 's/\/dev\/`cat /tmp/partition`/\\033[1;31m\/dev\/`cat /tmp/partition`\\033[1;m/g;' /tmp/fichier_disque_dur" > /tmp/exec_nom
		chmod +x /tmp/exec_nom
    		/tmp/exec_nom
        	rm -f /tmp/exec_nom
	        cat /tmp/fichier_disque_dur
    	        rm -f /tmp/partition
		echo
		echo -e "\033[1;34m   Appuyez sur la touche \033[1;37mEntrer\033[1;34m pour continuer ...\033[1;m"
		echo 
		read p
	fi
	oscar
