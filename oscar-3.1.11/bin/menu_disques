#!/bin/bash

## Copyright (c) 2003-2013 Tissoires Jean-François & Benjamin,  jftissoires@gmail.com
## Outil Système Complet d'Assistance Réseau: OSCAR
## Rapide de Sauvegarde aux Ordinateurs et Systèmes: RapideSOS
## Ce programme est sous Licence Publique Générale GNU publiée par la Free Software Foundation.

#   programme de menu administrateur réseau pour l'autorun


#----------------------------------------------------------------------------------------------------
eteindre_le_poste()
{
runme boite_eteindre_le_poste
if ( test -e /tmp/annuler_eteindre )
then
	rm -f /tmp/annuler_eteindre
	main
	return
fi

runme boite_eteindre_ordinateur
}
#----------------------------------------------------------------------------------------------------
boucle()  # retour au programme principal
{
echo
echo -e "`cat $chemin_langue/boucle_1`"
echo -ne "`cat $chemin_langue/boucle_2`"
read reponse
main
}
#----------------------------------------------------------------------------------------------------
main()
{
rm -f /tmp/sortir
rm -f /tmp/tempfile # des menus precedents sauf celui-ci /tmp/tempfile_____
rm -f /tmp/tempfile__
rm -f /tmp/tempfile___
rm -f /tmp/tempfile____

rm -f /tmp/tempfile______
rm -f /tmp/tempfile_______

calendrier=$(date +%d/%m/%y)
heure=$(date +%kh%Mmin)
rm -f /tmp/rien
echo "\Zn  \Zn  \Zn  \Zn  \Zn  \Zn  \Zn  \Zn \Zn  \Zn  \Zn  \Zn  " > /tmp/rien
output=exit
if ( test -e /root/sysresccd-pkg.txt )	# démarrage cd sysrcd avec ou sans option cdcache ou démarrage sur le poste si sysrcd
then	# menu pour sysrcd:
	cd_base=oscar_catalyst
	dialog  --no-cancel --colors --no-shadow \
	--backtitle "`cat /etc/banniere_oscar`" --title " `cat $chemin_langue/menu_22` " \
	--menu  "\n   `cat $chemin_langue/menu_23`\n\n `cat $chemin_langue/menu_1` `cat /tmp/rien`  le $calendrier à $heure\n " 11 80 0 \
	" " "" \
	partitions "`cat $chemin_langue/menu_20`" \
	gparted "`cat $chemin_langue/menu_25`" \
	menu_oscar "`cat $chemin_langue/menu_26`" \
	" " "" \
	wizard "`cat $chemin_langue/menu_27`" \
	" " "" \
        table_partitions "`cat $chemin_langue/menu_28`" \
	formater "`cat $chemin_langue/menu_29`" \
	testdisk "`cat $chemin_langue/menu_718`" \
	" " "" \
        halt "`cat $chemin_langue/menu_8`" \
	oscar "`cat $chemin_langue/menu_21`" \
	" " "" 2>/tmp/tempfile_____
	if [ $? = "255" ]
	then
		rm -f /tmp/tempfile_____
		rm -f /tmp/rien
		exit
	fi
	output=`cat /tmp/tempfile_____`
elif ( test -e /etc/demarrage_cdoscar_minimal )	# menu oscar avec catalyst et client minimal
then
	cd_base=oscar_catalyst
	dialog  --no-cancel --colors --no-shadow \
	--backtitle "`cat /etc/banniere_oscar`" --title " Menu des mémoires de masse " \
	--menu  "\n   `cat $chemin_langue/menu_23`\n\n `cat $chemin_langue/menu_1` `cat /tmp/rien`  le $calendrier à $heure\n " 11 80 0  \
	" " "" \
	"partitions" "`cat $chemin_langue/menu_20`" \
	"menu_oscar" "`cat $chemin_langue/menu_26`" \
	" " "" \
	"wizard" "`cat $chemin_langue/menu_27`" \
	" " "" \
        "table_partitions" "`cat $chemin_langue/menu_28`" \
	"formater" "`cat $chemin_langue/menu_29`" \
	"testdisk" "`cat $chemin_langue/menu_718`" \
	" " "" \
        "halt" "`cat $chemin_langue/menu_8`" \
	"oscar" "`cat $chemin_langue/menu_21`" \
	" " "" 2>/tmp/tempfile
	if [ $? = "255" ]
	then
		rm -f /tmp/tempfile_____
		rm -f /tmp/rien
		exit
	fi
	output=`cat /tmp/tempfile_____`
else	# menu oscar avec catalyst:
	cd_base=oscar_catalyst
	dialog  --no-cancel --colors --no-shadow \
	--backtitle "`cat /etc/banniere_oscar`" --title " Menu des mémoires de masse " \
	--menu  "\n   `cat $chemin_langue/menu_23`\n\n `cat $chemin_langue/menu_1` `cat /tmp/rien`  le $calendrier à $heure\n " 11 80 0  \
	" " "" \
	"partitions" "`cat $chemin_langue/menu_20`" \
	"gparted" "`cat $chemin_langue/menu_25`" \
	"menu_oscar" "`cat $chemin_langue/menu_26`" \
	" " "" \
	"wizard" "`cat $chemin_langue/menu_27`" \
	" " "" \
        "table_partitions" "`cat $chemin_langue/menu_28`" \
	"formater" "`cat $chemin_langue/menu_29`" \
	testdisk "`cat $chemin_langue/menu_718`" \
	" " "" \
        "halt" "`cat $chemin_langue/menu_8`" \
	"oscar" "`cat $chemin_langue/menu_21`" \
	" " "" 2>/tmp/tempfile_____
	if [ $? = "255" ]
	then
		rm -f /tmp/tempfile_____
		rm -f /tmp/rien
		exit
	fi
	output=`cat /tmp/tempfile_____`
fi

rm -f /tmp/rien
if [ "$output" = " " ]
	then
	main
elif [ "$output" = "" ]
	then
	main
elif [ $output = "partitions" ]
	then
	runme information_dd
	main			
elif [ $output = "gparted" ]
then
	texte_avant_rqt
	if ! ( test -e /tmp/sortir )
	then	
#	#	startx
		run_gparted
		texte_fin_rqt
	else
		rm -f /tmp/sortir
	fi
	main
elif [ $output = "qtparted" ]
then
	if [ "$cd_base" = "oscar_sysrcd" ]
	then
		/etc/init.d/gpm stop
	fi
	if ! ( test -e /etc/demarrage_cdoscar_minimal )
	then
	    texte_avant_rqt
	fi

	if ! ( test -e /tmp/sortir )
	then
#	#	startx
		if [ "$cd_base" = "oscar_sysrcd" ]
		then
			run_qtpartedjf
		else
			if ( test -e /etc/demarrage_cdoscar_minimal )
			then
			    run_qtpartedfb_oscar
			else
			    run_qtparted
			fi
		fi
		if ! ( test -e /etc/demarrage_cdoscar_minimal )
		then
		    echo "" > /tmp/fin_qt
		    texte_fin_rqt_srscd
		    rm -f /tmp/fin_qt
		fi
	else
		rm -f /tmp/sortir
	fi
	main
elif [ "$output" = "menu_oscar" ]
then
	maj_boot_oscar
	main
elif [ "$output" = "wizard" ]
then
	wizard_oscar
	main
elif [ "$output" = "taille_partition" ]
then
	if [ "$cd_base" = "oscar_sysrcd" ]
	then
		dimension
	else
		if ( test -e /etc/demarrage_cdoscar_minimal )
		then
		    dimension
		else
		    run_qtpartedfb_oscar
		fi
	fi
#	dimension
	if ( test -e /tmp/augmenter )
	then
	    exit
	fi
	main
#	boucle
elif [ "$output" = "table_partitions" ]
then
	runme boite_cfdisk
	main
elif [ "$output" = "formater" ]
then
	runme formater
	rm -f /tmp/fichier_disque_dur
	main
elif [ "$output" = "testdisk" ]
then
	testdisk
	main
elif [ $output = "gparted" ]
then
	texte_avant_rqt
	run_gparted
	texte_fin_rqt
	main
elif [ "$output" = "halt" ]
then
	rm -f /tmp/tempfile_____
        eteindre_le_poste
elif [ $output = "oscar" ]
then
	rm -f /tmp/tempfile_____
	exit
else
$output
fi
rm -f /tmp/tempfile_____
boucle
}
#----------------------------------------------------------------------------------------------------
PATH="/usr/share/oscar/bin:$PATH"
if ( test -e /usr/share/oscar/usr/choix_langue )
then
	choix_langue=`cat /usr/share/oscar/usr/choix_langue`
else
	echo "fr" > /usr/share/oscar/usr/choix_langue
	choix_langue=fr
	traduction
fi
chemin_langue=/usr/share/oscar/usr/langue/$choix_langue
main